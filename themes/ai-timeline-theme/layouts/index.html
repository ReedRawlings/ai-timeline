<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Site.Title }}</title>
    <meta name="description" content="{{ .Site.Params.description }}">
    <link rel="stylesheet" href="{{ "css/main.css" | relURL }}">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <h1 class="site-title">{{ .Site.Title }}</h1>
            <p class="site-description">{{ .Site.Params.description }}</p>
        </div>
    </header>

    <!-- Filter System -->
    <div class="filter-container compact">
        <div class="container">
            <div class="filter-bar compact">
                <select id="model-filter" class="filter-select">
                    <option value="">All Models</option>
                    {{ $models := slice }}
                    {{ range .Site.RegularPages }}
                        {{ if .Params.models }}
                            {{ $models = $models | append .Params.models }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $models }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="organization-filter" class="filter-select">
                    <option value="">All Organizations</option>
                    {{ $organizations := slice }}
                    {{ range .Site.RegularPages }}
                        {{ if .Params.organizations }}
                            {{ $organizations = $organizations | append .Params.organizations }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $organizations }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="key-figure-filter" class="filter-select">
                    <option value="">All Key Figures</option>
                    {{ $keyFigures := slice }}
                    {{ range .Site.RegularPages }}
                        {{ if .Params.key_figures }}
                            {{ $keyFigures = $keyFigures | append .Params.key_figures }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $keyFigures }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="impact-area-filter" class="filter-select">
                    <option value="">All Impact Areas</option>
                    {{ $impactAreas := slice }}
                    {{ range .Site.RegularPages }}
                        {{ if .Params.impact_areas }}
                            {{ $impactAreas = $impactAreas | append .Params.impact_areas }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $impactAreas }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <button id="clear-filters" class="clear-filters-btn">Clear All</button>
            </div>
        </div>
    </div>

    <main class="timeline-container">
        <div class="timeline">
            {{ $events := sort .Site.RegularPages "Date" "asc" }}
            {{ $currentYearMonth := "" }}
            {{ $groupOpen := false }}
            
            {{ range $events }}
                {{ $date := .Date }}
                {{ $yearMonth := printf "%s %d" ($date.Format "January") ($date.Year) }}
                
                {{ if ne $yearMonth $currentYearMonth }}
                    {{ if $groupOpen }}
                        </div>
                        </div>
                    {{ end }}
                    
                    <div class="timeline-group" data-year-month="{{ printf "%d-%02d" ($date.Year) ($date.Format "01") }}">
                        <div class="group-label">{{ $yearMonth }}</div>
                        <div class="group-events">
                    {{ $groupOpen = true }}
                    {{ $currentYearMonth = $yearMonth }}
                {{ end }}
                
                <div class="event-card" 
                     data-event-date="{{ $date.Format "2006-01-02" }}"
                     data-models="{{ if .Params.models }}{{ delimit .Params.models "|" }}{{ end }}"
                     data-organizations="{{ if .Params.organizations }}{{ delimit .Params.organizations "|" }}{{ end }}"
                     data-key-figures="{{ if .Params.key_figures }}{{ delimit .Params.key_figures "|" }}{{ end }}"
                     data-impact-areas="{{ if .Params.impact_areas }}{{ delimit .Params.impact_areas "|" }}{{ end }}"
                     data-description="{{ .Summary | plainify | htmlEscape }}"
                     data-link="{{ .Params.link }}"
                     data-tags="{{ delimit .Params.tags "|" }}">
                    <div class="card-content">
                        <div class="event-date">{{ $date.Format "Jan 2, 2006" }}</div>
                        <div class="event-title">{{ .Title }}</div>
                    </div>
                    <div class="card-detail" style="display:none;">
                        <div class="event-date">{{ $date.Format "Jan 2, 2006" }}</div>
                        <div class="event-title">{{ .Title }}</div>
                        <div class="event-description">{{ .Content }}</div>
                        <div class="event-metadata">
                            {{ if .Params.organizations }}
                            <div class="metadata-item"><span class="metadata-label">Organizations:</span> <span class="metadata-value">{{ delimit .Params.organizations ", " }}</span></div>
                            {{ end }}
                            {{ if .Params.models }}
                            <div class="metadata-item"><span class="metadata-label">Models:</span> <span class="metadata-value">{{ delimit .Params.models ", " }}</span></div>
                            {{ end }}
                            {{ if .Params.impact_areas }}
                            <div class="metadata-item"><span class="metadata-label">Impact Areas:</span> <span class="metadata-value">{{ delimit .Params.impact_areas ", " }}</span></div>
                            {{ end }}
                            {{ if .Params.key_figures }}
                            <div class="metadata-item"><span class="metadata-label">Key Figures:</span> <span class="metadata-value">{{ delimit .Params.key_figures ", " }}</span></div>
                            {{ end }}
                            {{ if .Params.link }}
                            <a href="{{ .Params.link }}" class="external-link" target="_blank" rel="noopener">Learn more</a>
                            {{ end }}
                        </div>
                        <div class="event-tags">
                            {{ range .Params.tags }}<span class="tag">{{ . }}</span>{{ end }}
                        </div>
                    </div>
                </div>
            {{ end }}
            
            {{ if $groupOpen }}
                </div>
                </div>
            {{ end }}
        </div>
    </main>

    <script src="{{ "js/main.js" | relURL }}"></script>
</body>
</html> 