<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Site.Title }}</title>
    <meta name="description" content="{{ .Site.Params.description }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ "css/main.css" | relURL }}">
</head>
<body>
    <header class="site-header">
        <div class="header-content">
            <h1 class="site-title">{{ .Site.Title }}</h1>
            <div class="header-rule"><span></span></div>
            <p class="site-description">{{ .Site.Params.description }}</p>
        </div>
    </header>

    <!-- Filter System -->
    <div class="filter-container compact">
        <div class="container">
            <div class="filter-bar compact">
                <select id="model-filter" class="filter-select">
                    <option value="">All Models</option>
                    {{ $models := slice }}
                    {{ range .Site.Data.events }}
                        {{ if .models }}
                            {{ $models = $models | append .models }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $models }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="organization-filter" class="filter-select">
                    <option value="">All Organizations</option>
                    {{ $organizations := slice }}
                    {{ range .Site.Data.events }}
                        {{ if .organizations }}
                            {{ $organizations = $organizations | append .organizations }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $organizations }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="key-figure-filter" class="filter-select">
                    <option value="">All Key Figures</option>
                    {{ $keyFigures := slice }}
                    {{ range .Site.Data.events }}
                        {{ if .key_figures }}
                            {{ $keyFigures = $keyFigures | append .key_figures }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $keyFigures }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="impact-area-filter" class="filter-select">
                    <option value="">All Impact Areas</option>
                    {{ $impactAreas := slice }}
                    {{ range .Site.Data.events }}
                        {{ if .impact_areas }}
                            {{ $impactAreas = $impactAreas | append .impact_areas }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $impactAreas }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="tag-filter" class="filter-select">
                    <option value="">All Tags</option>
                    {{ $tags := slice }}
                    {{ range .Site.Data.events }}
                        {{ if .tags }}
                            {{ $tags = $tags | append .tags }}
                        {{ end }}
                    {{ end }}
                    {{ range uniq $tags }}
                        <option value="{{ . }}">{{ . }}</option>
                    {{ end }}
                </select>
                <select id="grouping-mode" class="filter-select">
                    <option value="month" selected>By Month</option>
                    <option value="week">By Week</option>
                </select>
                <button id="clear-filters" class="clear-filters-btn">Clear All</button>
            </div>
        </div>
    </div>

    <main class="timeline-container">
        <div class="timeline">
            {{ $events := sort .Site.Data.events "date" "asc" }}
            {{ $currentYearMonth := "" }}
            {{ $groupOpen := false }}

            {{ range $events }}
                {{ $date := time .date }}
                {{ $yearMonth := printf "%s %d" ($date.Format "January") ($date.Year) }}

                {{ if ne $yearMonth $currentYearMonth }}
                    {{ if $groupOpen }}
                        </div>
                        </div>
                    {{ end }}

                    <div class="timeline-group monthly-group" data-year-month="{{ printf "%d-%02d" ($date.Year) ($date.Format "01") }}">
                        <div class="group-label">{{ $yearMonth }}</div>
                        <div class="group-events">
                    {{ $groupOpen = true }}
                    {{ $currentYearMonth = $yearMonth }}
                {{ end }}

                <div class="event-card"
                     data-event-date="{{ $date.Format "2006-01-02" }}"
                     data-models="{{ if .models }}{{ delimit .models "|" }}{{ end }}"
                     data-organizations="{{ if .organizations }}{{ delimit .organizations "|" }}{{ end }}"
                     data-key-figures="{{ if .key_figures }}{{ delimit .key_figures "|" }}{{ end }}"
                     data-impact-areas="{{ if .impact_areas }}{{ delimit .impact_areas "|" }}{{ end }}"
                     data-tags="{{ if .tags }}{{ delimit .tags "|" }}{{ end }}"
                     data-primary-tag="{{ if .tags }}{{ index .tags 0 }}{{ end }}"
                     data-description="{{ .description | plainify | htmlEscape }}"
                     data-link="{{ .link }}">
                    <div class="card-content">
                        <div class="event-date">{{ $date.Format "Jan 2, 2006" }}</div>
                        <div class="event-title">{{ .title }}</div>
                    </div>
                    <div class="card-detail" style="display:none;">
                        <div class="event-date">{{ $date.Format "Jan 2, 2006" }}</div>
                        <div class="event-title">{{ .title }}</div>
                        <div class="event-description">{{ .description }}</div>
                        <div class="event-metadata">
                            {{ if .organizations }}
                            <div class="metadata-item"><span class="metadata-label">Organizations</span> <span class="metadata-value">{{ delimit .organizations ", " }}</span></div>
                            {{ end }}
                            {{ if .models }}
                            <div class="metadata-item"><span class="metadata-label">Models</span> <span class="metadata-value">{{ delimit .models ", " }}</span></div>
                            {{ end }}
                            {{ if .impact_areas }}
                            <div class="metadata-item"><span class="metadata-label">Impact Areas</span> <span class="metadata-value">{{ delimit .impact_areas ", " }}</span></div>
                            {{ end }}
                            {{ if .key_figures }}
                            <div class="metadata-item"><span class="metadata-label">Key Figures</span> <span class="metadata-value">{{ delimit .key_figures ", " }}</span></div>
                            {{ end }}
                            {{ if .link }}
                            <a href="{{ .link }}" class="external-link" target="_blank" rel="noopener">Read more</a>
                            {{ end }}
                        </div>
                        <div class="event-tags">
                            {{ range .tags }}<span class="tag" data-tag="{{ . }}">{{ . }}</span>{{ end }}
                        </div>
                    </div>
                </div>
            {{ end }}

            {{ if $groupOpen }}
                </div>
                </div>
            {{ end }}
        </div>
    </main>

    <script src="{{ "js/main.js" | relURL }}"></script>
</body>
</html>
